# 我们要做什么

本书的目标是构建一个 Uniswap V3 的克隆版本。然而，我们不会完全照搬。主要原因是 Uniswap 是一个庞大的项目，包含许多细微之处和辅助机制——如果逐一讲解，会使本书篇幅过长，读者难以读完。因此，我们将着重构建 Uniswap 的核心部分，即其最复杂也最重要的机制。这包括流动性管理、交易、费用、外围合约、报价合约和 NFT 合约。我相信，完成这些之后，您将能够阅读 Uniswap V3 的源代码，并理解本书未涵盖的所有机制。


## 智能合约

读完本书后，您将学习到以下合约：

1. `UniswapV3Pool`–实现流动性管理和兑换的核心资金池合约。该合约与原始合约非常接近，但为了简化起见，一些实现细节有所不同，并且省略了一些功能。例如，我们的实现仅处理精确“输入”兑换，即输入数量已知的兑换。而原始实现还支持输出数量已知的兑换（例如，当您想要购买特定数量的代币时）。
1. `UniswapV3Factory`–该registry合约负责部署新的矿池并记录所有已部署的矿池。除了可以更改所有者和费用之外，该合约与原始合约基本相同。
1. `UniswapV3Manager`–一个外围合约，方便与资金池合约交互。这是 SwapRouter 的一个非常简化的实现。正如你所见，我没有区分“精确输入”和“精确输出”的交换，只实现了前者。
1. `UniswapV3Quoter` 是一个很棒的合约，允许在链上计算互换价格。它是 Quoter 和 QuoterV2 的精简版。同样，它仅支持“精确输入”的互换。
1. `UniswapV3NFTManager` 允许将流动性头寸转换为 NFT。它是 NonfungiblePositionManager 的简化实现。


## 前端程序

为了这本书，我还构建了一个简化版的 [Uniswap UI](https://app.uniswap.org/)。这只是一个非常简陋的克隆版本，我的 React 和前端技术也很差，但它演示了如何使用 Ethers.js 和 MetaMask 与智能合约进行交互。