#  Uniswap V3

> æœ¬ç« é‡è¿°äº† Uniswap V3 ç™½çš®ä¹¦çš„å†…å®¹ã€‚å†æ¬¡å¼ºè°ƒï¼Œå³ä½¿ä½ æ²¡æœ‰å®Œå…¨ç†è§£æ‰€æœ‰æ¦‚å¿µä¹Ÿå®Œå…¨æ²¡é—®é¢˜ã€‚å½“å®ƒä»¬è½¬åŒ–ä¸ºä»£ç æ—¶ï¼Œä½ ä¼šæ›´å®¹æ˜“ç†è§£ã€‚

ä¸ºäº†æ›´å¥½åœ°äº†è§£ Uniswap V3 å¸¦æ¥çš„åˆ›æ–°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Uniswap V2 çš„ä¸è¶³ä¹‹å¤„ã€‚

Uniswap V2 æ˜¯ä¸€ä¸ªé€šç”¨äº¤æ˜“æ‰€ï¼Œå®ƒé‡‡ç”¨äº†ä¸€ç§ AMM ç®—æ³•ã€‚ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰äº¤æ˜“å¯¹éƒ½ç›¸åŒã€‚äº¤æ˜“å¯¹å¯ä»¥æŒ‰ä»·æ ¼æ³¢åŠ¨æ€§è¿›è¡Œåˆ†ç»„ï¼š

1. ä»·æ ¼æ³¢åŠ¨æ€§ä¸­ç­‰å’Œé«˜çš„ä»£å¸ã€‚ç”±äºå¤§å¤šæ•°ä»£å¸çš„ä»·æ ¼æ²¡æœ‰ä¸ä»»ä½•è´§å¸æŒ‚é’©ï¼Œå› æ­¤å®ƒä»¬ä¼šå—åˆ°å¸‚åœºæ³¢åŠ¨çš„å½±å“ï¼Œæ‰€ä»¥è¿™ç±»ä»£å¸å‡ ä¹æ¶µç›–äº†æ‰€æœ‰ä»£å¸ã€‚
1. ä»·æ ¼æ³¢åŠ¨æ€§ä½çš„ä»£å¸ã€‚è¿™ç±»ä»£å¸åŒ…æ‹¬ä»·æ ¼æŒ‚é’©çš„ä»£å¸ï¼Œä¸»è¦æ˜¯ç¨³å®šå¸ï¼šä¾‹å¦‚ USDC/USDTã€USDC/DAIã€USDT/DAI ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ ETH/stETHã€ETH/rETHï¼ˆå°è£… ETH çš„å˜ä½“ï¼‰ã€‚

è¿™äº›äº¤æ˜“ç¾¤ä½“éœ€è¦ä¸åŒçš„èµ„é‡‘æ± é…ç½®ã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼Œé”šå®šä»£å¸éœ€è¦é«˜æµåŠ¨æ€§æ¥é™ä½å¤§é¢äº¤æ˜“çš„éœ€æ±‚æ•ˆåº”ï¼ˆæˆ‘ä»¬åœ¨ä¸Šä¸€ç« ä¸­å·²ç»äº†è§£è¿‡ï¼‰ã€‚æ— è®ºæˆ‘ä»¬ä¹°å–çš„ä»£å¸æ•°é‡æœ‰å¤šå¤§ï¼ŒUSDC å’Œ USDT çš„ä»·æ ¼éƒ½å¿…é¡»ä¿æŒåœ¨ 1 å·¦å³ã€‚ç”±äº Uniswap V2 çš„é€šç”¨ AMM ç®—æ³•ä¸å¤ªé€‚åˆç¨³å®šå¸äº¤æ˜“ï¼Œå› æ­¤å…¶ä»– AMMï¼ˆä¸»è¦æ˜¯ Curveï¼‰åœ¨ç¨³å®šå¸äº¤æ˜“ä¸­æ›´å—æ¬¢è¿ã€‚

é€ æˆæ­¤é—®é¢˜çš„åŸå› æ˜¯ Uniswap V2 èµ„é‡‘æ± ä¸­çš„æµåŠ¨æ€§æ˜¯æ— é™åˆ†å¸ƒçš„â€”â€”èµ„é‡‘æ± æµåŠ¨æ€§å…è®¸ä»¥ä» 0 åˆ°æ— ç©·å¤§çš„ä»»ä½•ä»·æ ¼è¿›è¡Œäº¤æ˜“ï¼š

![The curve is infinite](images/curve_infinite.png)

è¿™çœ‹ä¼¼å¹¶éåäº‹ï¼Œä½†å®é™…ä¸Šå´ä¼šé™ä½èµ„æœ¬æ•ˆç‡ã€‚èµ„äº§çš„å†å²ä»·æ ¼å§‹ç»ˆä¿æŒåœ¨æŸä¸ªæ—¢å®šçš„èŒƒå›´å†…ï¼Œæ— è®ºè¿™ä¸ªèŒƒå›´æ˜¯çª„è¿˜æ˜¯å®½ã€‚ä¾‹å¦‚ï¼ŒETH çš„å†å²ä»·æ ¼åŒºé—´ä¸º 0.75 è‡³ 4,800 ç¾å…ƒï¼ˆæ ¹æ® CoinMarketCap çš„æ•°æ®ï¼‰ã€‚å¦‚ä»Šï¼ˆ2022 å¹´ 6 æœˆï¼Œ1 ä¸ª ETH çš„ä»·æ ¼ä¸º 1,800 ç¾å…ƒï¼‰ï¼Œæ²¡æœ‰äººä¼šä»¥ 5,000 ç¾å…ƒçš„ä»·æ ¼è´­ä¹° 1 ä¸ª ETHï¼Œå› æ­¤åœ¨è¿™ä¸ªä»·æ ¼ä¸‹æä¾›æµåŠ¨æ€§æ¯«æ— æ„ä¹‰ã€‚åŒæ ·ï¼Œåœ¨è¿œç¦»å½“å‰ä»·æ ¼æˆ–æ°¸è¿œæ— æ³•è¾¾åˆ°çš„ä»·æ ¼åŒºé—´å†…æä¾›æµåŠ¨æ€§ä¹Ÿæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

> ä½†æ˜¯ï¼Œæˆ‘ä»¬éƒ½ç›¸ä¿¡ä»¥å¤ªåŠæœ‰æœä¸€æ—¥ä¼šè¾¾åˆ° 10,000 ç¾å…ƒã€‚

## é›†ä¸­æµåŠ¨æ€§

Uniswap V3 å¼•å…¥äº†é›†ä¸­æµåŠ¨æ€§ï¼ˆconcentrated liquidityï¼‰ï¼šæµåŠ¨æ€§æä¾›è€…ç°åœ¨å¯ä»¥é€‰æ‹©ä»–ä»¬å¸Œæœ›æä¾›æµåŠ¨æ€§çš„ä»·æ ¼åŒºé—´ã€‚è¿™æé«˜äº†èµ„é‡‘æ•ˆç‡ï¼Œå› ä¸ºå¯ä»¥å°†æ›´å¤šæµåŠ¨æ€§é›†ä¸­åˆ°ä¸€ä¸ªè¾ƒçª„çš„ä»·æ ¼åŒºé—´ï¼Œä»è€Œä½¿ Uniswap æ›´åŠ å¤šå…ƒåŒ–ï¼šç°åœ¨å¯ä»¥ä¸ºä¸åŒæ³¢åŠ¨æ€§çš„äº¤æ˜“å¯¹é…ç½®æµåŠ¨æ€§æ± ã€‚è¿™å°±æ˜¯ V3 å¯¹ V2 çš„æ”¹è¿›ä¹‹å¤„ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œä¸€ä¸ª Uniswap V3 äº¤æ˜“å¯¹æ˜¯ç”±è®¸å¤šä¸ªè¾ƒå°çš„ Uniswap V2 äº¤æ˜“å¯¹ç»„æˆçš„ã€‚V2 å’Œ V3 çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒV3 ä¸­ä¸€ä¸ªäº¤æ˜“å¯¹åŒ…å«å¤šä¸ªä»·æ ¼åŒºé—´ï¼Œæ¯ä¸ªè¾ƒçŸ­çš„ä»·æ ¼åŒºé—´éƒ½æœ‰å…¶æœ‰é™çš„æµåŠ¨æ€§å‚¨å¤‡ã€‚ä» 0 åˆ°æ— ç©·å¤§çš„æ•´ä¸ªä»·æ ¼åŒºé—´è¢«åˆ†å‰²æˆå¤šä¸ªè¾ƒçŸ­çš„ä»·æ ¼åŒºé—´ï¼Œæ¯ä¸ªåŒºé—´éƒ½æœ‰å…¶è‡ªèº«çš„æµåŠ¨æ€§ã€‚ä½†å…³é”®åœ¨äºï¼Œåœ¨è¿™äº›è¾ƒçŸ­çš„ä»·æ ¼åŒºé—´å†…ï¼Œå…¶è¿ä½œæ–¹å¼ä¸ Uniswap V2 å®Œå…¨ç›¸åŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´ä¸€ä¸ª V3 äº¤æ˜“å¯¹æ˜¯ç”±è®¸å¤šä¸ªè¾ƒå°çš„ V2 äº¤æ˜“å¯¹ç»„æˆçš„ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬è¯•ç€æŠŠå®ƒå¯è§†åŒ–ã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ¡æ›²çº¿æ˜¯æ— é™é•¿çš„ã€‚æˆ‘ä»¬åœ¨ç‚¹ a å’Œ b å¤„æˆªå–æ›²çº¿ï¼Œå¹¶ç§°è¿™ä¸¤ç‚¹ä¸ºæ›²çº¿çš„è¾¹ç•Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¹³ç§»æ›²çº¿ï¼Œä½¿è¾¹ç•Œä¸åæ ‡è½´é‡åˆã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¾—åˆ°çš„ç»“æœï¼š

![Uniswap V3 price range](images/curve_finite.png)

> å®ƒçœ‹èµ·æ¥å¾ˆå­¤å•ï¼Œå¯¹å§ï¼Ÿè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Uniswap V3 ä¸­æœ‰å¾ˆå¤šä»·æ ¼åŒºé—´â€”â€”è¿™æ ·å®ƒä»¬å°±ä¸ä¼šæ„Ÿåˆ°å­¤å•äº†ğŸ™‚

æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç« ä¸­çœ‹åˆ°çš„ï¼Œä¹°å–ä»£å¸ä¼šä½¿ä»·æ ¼æ²¿ç€æ›²çº¿ç§»åŠ¨ã€‚ä»·æ ¼åŒºé—´é™åˆ¶äº†ä»·æ ¼çš„æ³¢åŠ¨èŒƒå›´ã€‚å½“ä»·æ ¼ç§»åŠ¨åˆ°æ›²çº¿ä¸Šçš„ä»»ä¸€ç‚¹æ—¶ï¼Œä»£å¸æ± å°±ä¼šè€—å°½ï¼šå…¶ä¸­ä¸€ä¸ªä»£å¸å‚¨å¤‡å°†å˜ä¸º 0ï¼Œæ­¤æ—¶å°†æ— æ³•è´­ä¹°è¯¥ä»£å¸ã€‚

åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å‡è®¾èµ·å§‹ä»·æ ¼ä½äºæ›²çº¿çš„ä¸­é—´ä½ç½®ã€‚è¦åˆ°è¾¾ç‚¹ aï¼Œæˆ‘ä»¬éœ€è¦ä¹°å…¥æ‰€æœ‰å¯ç”¨çš„ y ä»£å¸ï¼Œå¹¶åœ¨èŒƒå›´å†…æœ€å¤§åŒ– x çš„å€¼ï¼›è¦åˆ°è¾¾ç‚¹ bï¼Œæˆ‘ä»¬éœ€è¦ä¹°å…¥æ‰€æœ‰å¯ç”¨çš„ x ä»£å¸ï¼Œå¹¶åœ¨èŒƒå›´å†…æœ€å¤§åŒ– y çš„å€¼ã€‚åœ¨è¿™äº›ç‚¹ä¸Šï¼ŒèŒƒå›´å†…éƒ½åªæœ‰ä¸€ä¸ªä»£å¸ï¼

> æœ‰è¶£çš„æ˜¯ï¼šè¿™å…è®¸ä½¿ç”¨ Uniswap V3 ä»·æ ¼èŒƒå›´ä½œä¸ºé™ä»·å•ï¼

äº¤æ˜“è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå½“å‰ä»·æ ¼åŒºé—´è¢«çªç ´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä»·æ ¼ä¼šæ»‘å…¥ä¸‹ä¸€ä¸ªä»·æ ¼åŒºé—´ã€‚å¦‚æœä¸‹ä¸€ä¸ªä»·æ ¼åŒºé—´ä¸å­˜åœ¨ï¼Œäº¤æ˜“å°±ä¼šéƒ¨åˆ†å®Œæˆâ€”â€”æˆ‘ä»¬å°†åœ¨æœ¬ä¹¦åé¢è¯¦ç»†æ¢è®¨è¿™ä¸€ç‚¹ã€‚

è¿™å°±æ˜¯ USDC/ETH æµåŠ¨æ€§æ± åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åˆ†å¸ƒæ–¹å¼ï¼š

![Liquidity in the real USDC/ETH pool](images/usdceth_liquidity.png)

ä½ å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰ä»·æ ¼é™„è¿‘æµåŠ¨æ€§å¾ˆå¼ºï¼Œä½†è¶Šè¿œç¦»å½“å‰ä»·æ ¼ï¼ŒæµåŠ¨æ€§å°±è¶Šå¼±â€”â€”è¿™æ˜¯å› ä¸ºæµåŠ¨æ€§æä¾›è€…åŠ›æ±‚æé«˜èµ„é‡‘æ•ˆç‡ã€‚æ­¤å¤–ï¼ŒæµåŠ¨æ€§èŒƒå›´å¹¶éæ— é™å¤§ï¼Œå…¶ä¸Šé™å·²åœ¨å›¾ä¸­æ˜¾ç¤ºã€‚

## Uniswap V3 çš„æ•°å­¦åŸç†

ä»æ•°å­¦è§’åº¦æ¥çœ‹ï¼ŒUniswap V3 åŸºäº V2ï¼šå®ƒä½¿ç”¨ç›¸åŒçš„å…¬å¼ï¼Œä½†è¿™äº›å…¬å¼â€¦â€¦æˆ‘ä»¬ä¸å¦¨ç§°ä¹‹ä¸ºå¢å¼ºç‰ˆã€‚ 
ä¸ºäº†å¤„ç†ä»·æ ¼åŒºé—´çš„è½¬æ¢ã€ç®€åŒ–æµåŠ¨æ€§ç®¡ç†å¹¶é¿å…èˆå…¥è¯¯å·®ï¼ŒUniswap V3 é‡‡ç”¨äº†ä»¥ä¸‹æ–°æ¦‚å¿µï¼š

$$L = \sqrt{xy}$$

$$\sqrt{P} = \sqrt{\frac{y}{x}}$$


$L$ä»£è¡¨æµåŠ¨æ€§ã€‚èµ„é‡‘æ± çš„æµåŠ¨æ€§æ˜¯ä»£å¸å‚¨å¤‡ï¼ˆå³ä¸¤ä¸ªæ•°å­—ï¼‰çš„ç»„åˆã€‚æˆ‘ä»¬çŸ¥é“å®ƒä»¬çš„ä¹˜ç§¯æ˜¯ $k$ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥æ¨å¯¼å‡ºæµåŠ¨æ€§çš„åº¦é‡ï¼Œå³

$\sqrt{xy}$

ä¸€ä¸ªä¹˜ä»¥è‡ªèº«ç­‰äº $k$ â€‹â€‹çš„æ•°å­—ã€‚$L$ æ˜¯ $x$ å’Œ $y$ çš„å‡ ä½•å¹³å‡å€¼ã€‚


$y/x$ è¡¨ç¤ºä»£å¸ 0 ç›¸å¯¹äºä»£å¸ 1 çš„ä»·æ ¼ã€‚ç”±äºèµ„é‡‘æ± ä¸­çš„ä»£å¸ä»·æ ¼äº’ä¸ºå€’æ•°ï¼Œå› æ­¤åœ¨è®¡ç®—ä¸­æˆ‘ä»¬åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼ˆæŒ‰ç…§æƒ¯ä¾‹ï¼ŒUniswap V3 ä½¿ç”¨ $y/x$ï¼‰ã€‚ä»£å¸ 1 ç›¸å¯¹äºä»£å¸ 0 çš„ä»·æ ¼å°±æ˜¯ $y/x$ã€‚ç±»ä¼¼çš„, $\frac{1}{\sqrt{P}} = \frac{1}{\sqrt{y/x}} = \sqrt{\frac{x}{y}}$.

ä¸ºä»€ä¹ˆç”¨ $\sqrt{p}$ è€Œä¸æ˜¯ $p$? æœ‰ä¸¤ä¸ªåŸå› :

1. å¹³æ–¹æ ¹è®¡ç®—å¹¶ä¸ç²¾ç¡®ï¼Œä¼šäº§ç”Ÿèˆå…¥è¯¯å·®ã€‚å› æ­¤ï¼Œåœ¨åˆçº¦ä¸­ç›´æ¥å­˜å‚¨å¹³æ–¹æ ¹å€¼ï¼ˆæˆ‘ä»¬ä¸ä¼šåœ¨åˆçº¦ä¸­å­˜å‚¨ x å’Œ y çš„å€¼ï¼‰æ›´ä¸ºç®€ä¾¿ã€‚
1. $\sqrt{P}$ ä¸ L æœ‰æœ‰è¶£çš„è”ç³»ï¼šL è¡¨ç¤ºäº§å‡ºé‡å˜åŒ–åŒºé—´ä¸$\sqrt{P}$.å˜åŒ–åŒºé—´çš„ä¹‹æ¯” 

    $$L = \frac{\Delta y}{\Delta\sqrt{P}}$$

> è¯æ˜:
$$L = \frac{\Delta y}{\Delta\sqrt{P}}$$
$$\sqrt{xy} = \frac{y_1 - y_0}{\sqrt{P_1} - \sqrt{P_0}}$$
$$\sqrt{xy} (\sqrt{P_1} - \sqrt{P_0}) = y_1 - y_0$$
$$\sqrt{xy} (\sqrt{\frac{y_1}{x_1}} - \sqrt{\frac{y_0}{x_0}}) = y_1 - y_0$$
$$\textrm{Since } \sqrt{x_1y_1} = \sqrt{x_0y_0} = \sqrt{xy} = L,$$
$$\sqrt{\frac{x_1y_1y_1}{x_1}} - \sqrt{\frac{x_0y_0y_0}{x_0}} = y_1 - y_0$$
$$\sqrt{y_1^2} - \sqrt{y_0^2} = y_1 - y_0$$
$$y_1 - y_0 = y_1 - y_0$$

## å®šä»·

åŒæ ·ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®¡ç®—å®é™…ä»·æ ¼â€”â€”æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—ä¾›åº”é‡ã€‚æ­¤å¤–ï¼Œç”±äºæˆ‘ä»¬ä¸ä¼šè·Ÿè¸ªå’Œå­˜å‚¨ x å’Œ yï¼Œæˆ‘ä»¬çš„è®¡ç®—å°†ä»…åŸºäº $L$ å’Œ $\sqrt{P}$ã€‚æ ¹æ®ä¸Šè¿°å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å‡º Î”y


$$\Delta y = \Delta \sqrt{P} L$$

> å‚è§ä¸Šè¿°è¯æ˜çš„ç¬¬ä¸‰æ­¥ã€‚

æ­£å¦‚æˆ‘ä»¬å‰é¢è®¨è®ºçš„ï¼Œèµ„é‡‘æ± ä¸­çš„ä»·æ ¼äº’ä¸ºå€’æ•°ã€‚å› æ­¤, $\Delta x$ :

$$\Delta x = \Delta \frac{1}{\sqrt{P}} L$$


L å’Œ$\sqrt{P}$ä½¿æˆ‘ä»¬èƒ½å¤Ÿé¿å…å­˜å‚¨å’Œæ›´æ–°èµ„é‡‘æ± å‚¨å¤‡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦æ¯æ¬¡éƒ½è®¡ç®— P ï¼Œå› ä¸ºæˆ‘ä»¬æ€»èƒ½æ‰¾åˆ° $\Delta \sqrt{P}$ åŠå…¶å€’æ•°ã€‚

## Ticks

æ­£å¦‚æœ¬ç« æ‰€è¿°ï¼ŒV2 çš„æ— é™ä»·æ ¼åŒºé—´åœ¨ V3 ä¸­è¢«åˆ†å‰²æˆæ›´çŸ­çš„ä»·æ ¼åŒºé—´ã€‚æ¯ä¸ªæ›´çŸ­çš„ä»·æ ¼åŒºé—´éƒ½æœ‰å…¶è¾¹ç•Œâ€”â€”ä¸Šé™å’Œä¸‹é™ã€‚ä¸ºäº†è¿½è¸ªè¿™äº›è¾¹ç•Œçš„åæ ‡ï¼ŒUniswap V3 ä½¿ç”¨ ticksï¼ˆæœ€å°ä»·æ ¼å˜åŠ¨å•ä½ï¼‰ã€‚

![Price ranges and ticks](images/ticks_and_ranges.png)

åœ¨V3ç‰ˆæœ¬ä¸­ï¼Œæ•´ä¸ªä»·æ ¼èŒƒå›´ç”±å‡åŒ€åˆ†å¸ƒçš„ç¦»æ•£ä»·æ ¼åˆ»åº¦åˆ’åˆ†ã€‚æ¯ä¸ªåˆ»åº¦éƒ½æœ‰ä¸€ä¸ªç´¢å¼•ï¼Œå¹¶å¯¹åº”äºç‰¹å®šçš„ä»·æ ¼ï¼š

$$p(i) = 1.0001^i$$

å…¶ä¸­ $p(i)$ æ˜¯ç¬¬ i ä¸ªåˆ»åº¦çš„ä»·æ ¼ã€‚1.0001 çš„å¹‚å…·æœ‰ä¸€ä¸ªç†æƒ³çš„ç‰¹æ€§ï¼šä¸¤ä¸ªç›¸é‚»åˆ»åº¦ä¹‹é—´çš„å·®å¼‚ä¸º 0.01% æˆ– 1 ä¸ªåŸºå‡†ç‚¹ã€‚

> åŸºå‡†ç‚¹ï¼ˆ1%çš„ç™¾åˆ†ä¹‹ä¸€ï¼Œæˆ–0.01%ï¼Œæˆ–0.0001ï¼‰æ˜¯é‡‘èé¢†åŸŸä¸­è¡¡é‡ç™¾åˆ†æ¯”çš„å•ä½ã€‚å½“å„å›½å¤®è¡Œå®£å¸ƒåˆ©ç‡å˜åŠ¨æ—¶ï¼Œæ‚¨å¯èƒ½å¬è¯´è¿‡åŸºç‚¹ã€‚

æ­£å¦‚æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„ï¼ŒUniswap V3 å­˜å‚¨çš„æ˜¯ $\sqrt{P}$ ï¼Œè€Œä¸æ˜¯ Pã€‚å› æ­¤ï¼Œå…¬å¼å®é™…ä¸Šæ˜¯ï¼š

$$\sqrt{p(i)} = \sqrt{1.0001}^i = 1.0001 ^{\frac{i}{2}}$$

å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹å€¼ï¼š $\sqrt{p(0)} = 1$, $\sqrt{p(1)} = \sqrt{1.0001} \approx 1.00005$, $\sqrt{p(-1)} \approx 0.99995$.

Tick æ˜¯æ•´æ•°ï¼Œå¯ä»¥æ˜¯æ­£æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå½“ç„¶ï¼Œå®ƒä»¬ä¸æ˜¯æ— é™çš„ã€‚Uniswap V3 å°† $\sqrt{P}$ å­˜å‚¨ä¸ºä¸€ä¸ªå®šç‚¹æ•° Q64.96ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç†æ•°ï¼Œæ•´æ•°éƒ¨åˆ†ä½¿ç”¨ 64 ä½ï¼Œå°æ•°éƒ¨åˆ†ä½¿ç”¨ 96 ä½ã€‚å› æ­¤ï¼Œä»·æ ¼ï¼ˆ$\sqrt{P}$ çš„å¹³æ–¹ï¼‰çš„èŒƒå›´ä¸ºï¼š$[2^{-128}, 2^{128}]$ã€‚åˆ»åº¦çº¿çš„èŒƒå›´ä¸ºï¼š

$$[log_{1.0001}2^{-128}, log_{1.0001}{2^{128}}] = [-887272, 887272]$$
> å®šç‚¹æ•°å®é™…å€¼ç­‰äº160ä½çš„æ•´æ•°é™¤ä»¥96ä½:
$\frac{2^{160}}{2^{96}}$
> æ‰€ä»¥$\sqrt{P}$èŒƒå›´$[2^{-64}, 2^{64}]$

> è¦æ·±å…¥äº†è§£ Uniswap V3 çš„æ•°å­¦åŸç†ï¼Œæˆ‘å¼ºçƒˆæ¨è [Atis Elsts](https://twitter.com/atiselsts) æ’°å†™çš„è¿™ç¯‡[æŠ€æœ¯è¯´æ˜](https://atiselsts.github.io/pdfs/uniswap-v3-liquidity-math.pdf)ã€‚